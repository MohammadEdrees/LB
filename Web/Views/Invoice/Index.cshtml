@model IEnumerable<Domain.Entities.Invoices.Invoice>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Invoices";

}

<div>
    <div>
        <a class="btn btn-outline-info mb-1" asp-action="Create">Add New Invoice</a>
    </div>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Invoice Number</th>
                <th>Date</th>
                <th>Customer</th>
                <th>Payment</th>
                <th>Description</th>
                <th>Delete</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Count() > 0)
            {
                foreach (var inv in Model)
                {
                    <tr>
                        <td>@inv.InvoiceNum</td>
                        <td>@inv.Date</td>
                        <td>@inv.Customer</td>
                        <td>@inv.PaymentMethod</td>
                        <td>@inv.Description</td>
                        <td><a asp-action="Delete" asp-route-num="@inv.InvoiceNum" class="btn btn-outline-danger" type="button" >Delete</a></td>
                        <td>
                            <input class="btn btn-outline-warning editbtn" value="Edit" type="button" />
                            </td>
                    </tr>
                    @if (inv.Items.Any())
                    {
                        
                    <tr >
                        <td colspan="8">
                            <div>
                                <table class="table table-bordered table-striped w-100 h-100">
                                    <thead>
                                        <tr>
                                            <th>ItemCode</th>
                                            <th>ItemName</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Edit</th>
                                            <th>Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in inv.Items)
                                        {
                                            <tr>
                                                <td>@item.ItemCode</td>
                                                <td>@item.ItemName</td>
                                                <td>@item.Price</td>
                                                <td>@item.Qty</td>
                                                <td>
                                                    <input class="btn btn-outline-warning" value="Edit" />
                                                </td>
                                                <td>
                                                    <input  class="btn btn-outline-warning" value="Delete" />
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>

                            </div>
                        </td>

                    </tr>
                    }


                }
            }
        </tbody>
    </table>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            $('.editbtn').click(function () {
                var currentTD = $(this).parents('tr').find('td');
                console.log(currentTD)
                console.log($(this).val())
                if ($(this).val() == 'Edit') {
                    $.each(currentTD, function () {
                        $(this).prop('contenteditable', true)
                    });

                        

                } else {
                    $.each(currentTD, function () {
                        $(this).prop('contenteditable', false)
                    });
                }

                $(this).val($(this).val() == 'Edit' ? 'Save' : 'Edit')

            });

        });
    </script>
} 


